{
  "spec_id": "006",
  "spec_name": "jira-integration-map",
  "updated": "2026-02-12T00:00:00Z",
  "anthropic_patterns": ["Ralph looping", "JSON task state"],
  "completion_promise": "<promise>SPEC-006-COMPLETE</promise>",
  "tasks": [
    {
      "id": "T001",
      "phase": "setup",
      "description": "Scaffold packages/jira-mcp/ package with package.json, tsconfig.json, vitest.config.ts, and directory structure (src/, __tests__/unit/, __tests__/integration/)",
      "status": "pending",
      "parallel": false,
      "target_file": "packages/jira-mcp/package.json",
      "gate": null,
      "gate_check": null,
      "verify": "package.json exists with @wine-cellar/jira-mcp name, type: module, dependencies on @modelcontextprotocol/sdk and zod@3; tsconfig.json compiles; vitest.config.ts exists",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": null,
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T002",
      "phase": "setup",
      "description": "Create types.ts with shared TypeScript types from contract definitions (JiraSyncState, TaskMapping, JiraSyncConfig, Jira API types)",
      "status": "pending",
      "parallel": false,
      "target_file": "packages/jira-mcp/src/types.ts",
      "gate": "T001",
      "gate_check": null,
      "verify": "types.ts compiles without errors; exports JiraSyncState, TaskMapping, EpicMapping, JiraSyncConfig, JiraAuthConfig interfaces",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": null,
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T003",
      "phase": "tdd-unit",
      "description": "Write failing unit tests for config.ts — env var loading, validation (missing vars, invalid URL), default mappings",
      "status": "pending",
      "parallel": true,
      "target_file": "packages/jira-mcp/__tests__/unit/config.test.ts",
      "gate": "T002",
      "gate_check": null,
      "verify": "Test file runs with vitest, all tests FAIL (red phase — no implementation yet)",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": null,
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T004",
      "phase": "tdd-unit",
      "description": "Write failing unit tests for hash.ts — content hashing, hash comparison for conflict detection",
      "status": "pending",
      "parallel": true,
      "target_file": "packages/jira-mcp/__tests__/unit/hash.test.ts",
      "gate": "T002",
      "gate_check": null,
      "verify": "Test file runs with vitest, all tests FAIL (red phase)",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": null,
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T005",
      "phase": "tdd-unit",
      "description": "Write failing unit tests for mapper.ts — SpecKit task to Jira issue field mapping, status transition mapping, Epic/Story/Sub-task differentiation",
      "status": "pending",
      "parallel": true,
      "target_file": "packages/jira-mcp/__tests__/unit/mapper.test.ts",
      "gate": "T002",
      "gate_check": null,
      "verify": "Test file runs with vitest, all tests FAIL (red phase)",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": null,
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T006",
      "phase": "implement-unit",
      "description": "Implement config.ts — load JIRA_URL, JIRA_EMAIL, JIRA_API_TOKEN, JIRA_PROJECT_KEY from env vars with Zod validation, default status transition mappings",
      "status": "pending",
      "parallel": true,
      "target_file": "packages/jira-mcp/src/config.ts",
      "gate": "T003",
      "gate_check": null,
      "verify": "All config unit tests pass (green phase)",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": null,
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T007",
      "phase": "implement-unit",
      "description": "Implement hash.ts — SHA-256 content hashing for task description + status, comparison function for conflict detection",
      "status": "pending",
      "parallel": true,
      "target_file": "packages/jira-mcp/src/hash.ts",
      "gate": "T004",
      "gate_check": null,
      "verify": "All hash unit tests pass (green phase)",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": null,
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T008",
      "phase": "implement-unit",
      "description": "Implement mapper.ts — map SpecKit task fields to Jira issue create/update payloads, status to transition names, T-VERIFY tasks to Sub-task issue type, gate dependencies to Blocked-by links",
      "status": "pending",
      "parallel": true,
      "target_file": "packages/jira-mcp/src/mapper.ts",
      "gate": "T005",
      "gate_check": null,
      "verify": "All mapper unit tests pass (green phase)",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": null,
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T009",
      "phase": "tdd-integration",
      "description": "Write failing integration tests for jira-client.ts — mocked HTTP for issue CRUD, transitions, issue links, Epic Link field discovery, auth header, error handling (401, 404, 429, timeout)",
      "status": "pending",
      "parallel": false,
      "target_file": "packages/jira-mcp/__tests__/integration/jira-client.test.ts",
      "gate": "T006",
      "gate_check": null,
      "verify": "Test file runs with vitest, all tests FAIL (red phase)",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": null,
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T010",
      "phase": "implement-integration",
      "description": "Implement jira-client.ts — Jira REST API v3 HTTP client with Basic auth, create/update/get issue, get/perform transitions, create issue links, Epic Link field discovery, JQL search, error handling with retry for transient errors",
      "status": "pending",
      "parallel": false,
      "target_file": "packages/jira-mcp/src/jira-client.ts",
      "gate": "T009",
      "gate_check": null,
      "verify": "All jira-client integration tests pass (green phase)",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": null,
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T011",
      "phase": "tdd-integration",
      "description": "Write failing integration tests for sync-engine.ts — first sync (create Epic + Stories + Sub-tasks + links), re-sync (update statuses, idempotent), conflict detection (skip + warn), removed task handling (Won't Do transition), jira-sync.json read/write",
      "status": "pending",
      "parallel": false,
      "target_file": "packages/jira-mcp/__tests__/integration/sync-engine.test.ts",
      "gate": "T010",
      "gate_check": null,
      "verify": "Test file runs with vitest, all tests FAIL (red phase)",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": null,
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T012",
      "phase": "implement-integration",
      "description": "Implement sync-engine.ts — core sync orchestration: read tasks.json + jira-sync.json, diff state, create/update/skip/remove issues via jira-client, write updated jira-sync.json, return sync summary with warnings",
      "status": "pending",
      "parallel": false,
      "target_file": "packages/jira-mcp/src/sync-engine.ts",
      "gate": "T011",
      "gate_check": null,
      "verify": "All sync-engine integration tests pass (green phase)",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": null,
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T013",
      "phase": "tdd-mcp",
      "description": "Write failing integration tests for MCP tool registration — sync_spec_to_jira, get_jira_status, update_task_status tool invocations with mocked sync engine",
      "status": "pending",
      "parallel": false,
      "target_file": "packages/jira-mcp/__tests__/integration/mcp-tools.test.ts",
      "gate": "T012",
      "gate_check": null,
      "verify": "Test file runs with vitest, all tests FAIL (red phase)",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": null,
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T014",
      "phase": "implement-mcp",
      "description": "Implement index.ts — MCP server entry point with McpServer + StdioServerTransport, register sync_spec_to_jira, get_jira_status, update_task_status tools with Zod input schemas, wire to sync-engine",
      "status": "pending",
      "parallel": false,
      "target_file": "packages/jira-mcp/src/index.ts",
      "gate": "T013",
      "gate_check": null,
      "verify": "All MCP tools integration tests pass (green phase); server builds with tsc",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": null,
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T015",
      "phase": "integration",
      "description": "Add jira-speckit MCP server configuration to .claude/settings.json, add build script to package.json, verify npm run build succeeds and node build/index.js starts without error",
      "status": "pending",
      "parallel": false,
      "target_file": "packages/jira-mcp/package.json",
      "gate": "T014",
      "gate_check": null,
      "verify": "npm run build -w packages/jira-mcp succeeds; node packages/jira-mcp/build/index.js starts (exits cleanly with no input); .claude/settings.json has mcpServers.jira-speckit entry",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": null,
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T-DOC-GATE",
      "phase": "verify",
      "description": "Documentation reconciliation - identify and update affected docs (CLAUDE.md, project-summary.md, etc.)",
      "status": "pending",
      "parallel": false,
      "target_file": null,
      "gate": "T015",
      "gate_check": null,
      "verify": "documentation-update-report.md generated with Status: PASS",
      "auto_agent": "documentation-reconciliation",
      "gate_type": "review",
      "scope": "changed",
      "block_on": "Status: DRIFT_DETECTED in report",
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T-FINAL",
      "phase": "verify",
      "description": "All verification gates passed - spec 006 complete",
      "status": "pending",
      "parallel": false,
      "target_file": null,
      "gate": "T-DOC-GATE",
      "gate_check": null,
      "verify": "All composed checks pass",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": "Any check failure",
      "timeout_ms": 600000,
      "composed_of": [
        {
          "check": "typecheck",
          "command": "npm run type-check",
          "required": true,
          "parallel": true,
          "parallel_group": "static",
          "timeout_ms": 120000
        },
        {
          "check": "lint",
          "command": "npm run lint",
          "required": true,
          "parallel": true,
          "parallel_group": "static",
          "timeout_ms": 120000
        },
        {
          "check": "unit",
          "command": "npm test -w packages/jira-mcp",
          "required": true,
          "depends_on": ["typecheck", "lint"],
          "timeout_ms": 300000
        },
        {
          "check": "integration",
          "command": "npm test",
          "required": true,
          "depends_on": ["unit"],
          "timeout_ms": 300000,
          "requires_containers": false,
          "retry_policy": "none"
        },
        {
          "check": "smoke",
          "command": "npm run test:smoke",
          "required": true,
          "depends_on": ["integration"],
          "timeout_ms": 90000,
          "requires_containers": true,
          "retry_policy": "transient"
        },
        {
          "check": "security",
          "agent": "security-audit",
          "required": true,
          "depends_on": ["smoke"],
          "scope": "changed",
          "block_on": "Any P1 or P2 finding"
        },
        {
          "check": "code-review",
          "agent": "code-reviewer",
          "required": true,
          "depends_on": ["security"],
          "scope": "changed",
          "block_on": "Any Critical issue"
        }
      ],
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    }
  ]
}
