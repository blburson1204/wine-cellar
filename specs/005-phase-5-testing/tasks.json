{
  "spec_id": "005",
  "spec_name": "phase-5-testing",
  "updated": "2026-01-29T00:00:00Z",
  "anthropic_patterns": ["Ralph looping", "JSON task state"],
  "completion_promise": "<promise>SPEC-005-COMPLETE</promise>",
  "tasks": [
    {
      "id": "T001",
      "phase": "setup",
      "description": "Install vitest-axe as devDependency in apps/web",
      "status": "pending",
      "parallel": false,
      "target_file": "apps/web/package.json",
      "gate": null,
      "gate_check": null,
      "verify": "vitest-axe listed in devDependencies, node_modules/vitest-axe exists",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": null,
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T002",
      "phase": "setup",
      "description": "Configure vitest-axe matchers in vitest.setup.ts and add vitest-axe.d.ts type declarations",
      "status": "pending",
      "parallel": false,
      "target_file": "apps/web/vitest.setup.ts",
      "gate": "T001",
      "gate_check": null,
      "verify": "vitest.setup.ts imports and extends vitest-axe matchers; vitest-axe.d.ts exists; npx vitest run --reporter=verbose passes with setup",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": null,
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T003",
      "phase": "a11y-tests",
      "description": "Write axe-core accessibility tests for WineCard component",
      "status": "pending",
      "parallel": true,
      "target_file": "apps/web/src/__tests__/accessibility/WineCard.a11y.test.tsx",
      "gate": "T002",
      "gate_check": null,
      "verify": "Test file runs with vitest, toHaveNoViolations assertions pass",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": null,
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T004",
      "phase": "a11y-tests",
      "description": "Write axe-core accessibility tests for WineTable (mobile card layout + desktop table layout)",
      "status": "pending",
      "parallel": true,
      "target_file": "apps/web/src/__tests__/accessibility/WineTable.a11y.test.tsx",
      "gate": "T002",
      "gate_check": null,
      "verify": "Test file runs, both mobile and desktop layout pass toHaveNoViolations",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": null,
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T005",
      "phase": "a11y-tests",
      "description": "Write axe-core accessibility tests for WineDetailModal (view mode + edit/add mode)",
      "status": "pending",
      "parallel": true,
      "target_file": "apps/web/src/__tests__/accessibility/WineDetailModal.a11y.test.tsx",
      "gate": "T002",
      "gate_check": null,
      "verify": "Test file runs, view and edit modes pass toHaveNoViolations",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": null,
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T006",
      "phase": "a11y-tests",
      "description": "Write axe-core accessibility tests for WineFilters component",
      "status": "pending",
      "parallel": true,
      "target_file": "apps/web/src/__tests__/accessibility/WineFilters.a11y.test.tsx",
      "gate": "T002",
      "gate_check": null,
      "verify": "Test file runs, toHaveNoViolations passes",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": null,
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T007",
      "phase": "a11y-tests",
      "description": "Write axe-core accessibility tests for FilterDrawer component",
      "status": "pending",
      "parallel": true,
      "target_file": "apps/web/src/__tests__/accessibility/FilterDrawer.a11y.test.tsx",
      "gate": "T002",
      "gate_check": null,
      "verify": "Test file runs, toHaveNoViolations passes",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": null,
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T008",
      "phase": "a11y-tests",
      "description": "Write axe-core accessibility tests for Combobox component",
      "status": "pending",
      "parallel": true,
      "target_file": "apps/web/src/__tests__/accessibility/Combobox.a11y.test.tsx",
      "gate": "T002",
      "gate_check": null,
      "verify": "Test file runs, toHaveNoViolations passes",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": null,
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T009",
      "phase": "a11y-tests",
      "description": "Write axe-core accessibility tests for MobileFilterToggle, MobileSortSelector, LoadingSpinner, WineListSkeleton",
      "status": "pending",
      "parallel": true,
      "target_file": "apps/web/src/__tests__/accessibility/SmallComponents.a11y.test.tsx",
      "gate": "T002",
      "gate_check": null,
      "verify": "Test file runs, all 4 components pass toHaveNoViolations",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": null,
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T010",
      "phase": "a11y-fixes",
      "description": "Fix any axe-core accessibility violations discovered in T003-T009 (update source components)",
      "status": "pending",
      "parallel": false,
      "target_file": null,
      "gate": "T009",
      "gate_check": null,
      "verify": "All a11y tests in T003-T009 pass with zero critical/serious violations; source components updated if needed",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": "Any critical or serious axe violation remaining",
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T011",
      "phase": "focus-tests",
      "description": "Write focus management tests for FilterDrawer (TDD: focus trap, auto-focus on open, focus restoration on close — expect failures)",
      "status": "pending",
      "parallel": true,
      "target_file": "apps/web/src/__tests__/focus/FilterDrawer.focus.test.tsx",
      "gate": "T002",
      "gate_check": null,
      "verify": "Test file created; tests define expected focus trap + restoration behavior; tests fail (Red phase — FilterDrawer lacks focus management)",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": null,
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T012",
      "phase": "focus-tests",
      "description": "Write focus management tests for WineDetailModal (TDD: focus restoration on close — expect failures)",
      "status": "pending",
      "parallel": true,
      "target_file": "apps/web/src/__tests__/focus/WineDetailModal.focus.test.tsx",
      "gate": "T002",
      "gate_check": null,
      "verify": "Test file created; tests define expected focus restoration; tests fail (Red phase — Modal lacks focus restoration)",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": null,
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T013",
      "phase": "focus-tests",
      "description": "Write focus management tests for Combobox (arrow key navigation, Escape returns focus to input)",
      "status": "pending",
      "parallel": true,
      "target_file": "apps/web/src/__tests__/focus/Combobox.focus.test.tsx",
      "gate": "T002",
      "gate_check": null,
      "verify": "Test file created; tests verify Combobox focus behavior (should pass — Headless UI handles it)",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": null,
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T014",
      "phase": "focus-fixes",
      "description": "Fix FilterDrawer.tsx: add focus trap (Tab/Shift+Tab cycling), auto-focus on open, focus restoration on close",
      "status": "pending",
      "parallel": false,
      "target_file": "apps/web/src/components/FilterDrawer.tsx",
      "gate": "T011",
      "gate_check": null,
      "verify": "FilterDrawer.focus.test.tsx passes (Green phase); focus trap cycles Tab within drawer; focus returns to MobileFilterToggle on close",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": "FilterDrawer.focus.test.tsx failures",
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T015",
      "phase": "focus-fixes",
      "description": "Fix WineDetailModal.tsx: add focus restoration on close (store activeElement on open, restore on close)",
      "status": "pending",
      "parallel": false,
      "target_file": "apps/web/src/components/WineDetailModal.tsx",
      "gate": "T012",
      "gate_check": null,
      "verify": "WineDetailModal.focus.test.tsx passes (Green phase); focus returns to triggering element on close",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": "WineDetailModal.focus.test.tsx failures",
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T016",
      "phase": "focus-verify",
      "description": "Verify all focus management tests pass (FilterDrawer + WineDetailModal + Combobox)",
      "status": "pending",
      "parallel": false,
      "target_file": null,
      "gate": "T015",
      "gate_check": null,
      "verify": "cd apps/web && npx vitest run src/__tests__/focus/ — all tests pass",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": "Any focus test failure",
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T017",
      "phase": "viewport-tests",
      "description": "Write cross-viewport integration tests at 375px (iPhone SE), 393px (iPhone 14 Pro), 768px (iPad), 1024px (Desktop)",
      "status": "pending",
      "parallel": false,
      "target_file": "apps/web/src/__tests__/integration/viewport-devices.test.tsx",
      "gate": "T002",
      "gate_check": null,
      "verify": "Test file verifies correct layout at each viewport; mobile viewports show cards + MobileSortSelector; desktop shows table + sidebar",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": null,
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T018",
      "phase": "bundle",
      "description": "Run next build in apps/web and document bundle size baseline in research.md",
      "status": "pending",
      "parallel": false,
      "target_file": "specs/005-phase-5-testing/research.md",
      "gate": "T016",
      "gate_check": null,
      "verify": "next build completes successfully; bundle sizes documented in research.md; no page JS > 200kB gzipped (soft target)",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": "next build failure",
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T019",
      "phase": "regression",
      "description": "Run full test suite to verify zero regressions (all 675+ existing tests + new tests pass)",
      "status": "pending",
      "parallel": false,
      "target_file": null,
      "gate": "T018",
      "gate_check": "npm test",
      "verify": "npm test exits 0; total test count >= 710 (675 existing + ~35-45 new); zero failures",
      "auto_agent": null,
      "gate_type": "tests",
      "scope": "full",
      "block_on": "Any test failure",
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T-DOC-GATE",
      "phase": "verify",
      "description": "Documentation reconciliation - identify and update affected docs",
      "status": "pending",
      "parallel": false,
      "target_file": null,
      "agent": "documentation-reconciliation",
      "gate": "T019",
      "gate_check": null,
      "verify": "documentation-update-report.md generated with Status: PASS",
      "auto_agent": "documentation-reconciliation",
      "gate_type": null,
      "scope": null,
      "block_on": "Status: DRIFT_DETECTED in report",
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    },
    {
      "id": "T-FINAL",
      "phase": "verify",
      "description": "All verification gates passed - spec complete",
      "status": "pending",
      "parallel": false,
      "target_file": null,
      "gate": "T-DOC-GATE",
      "gate_check": null,
      "verify": "All composed_of checks pass",
      "auto_agent": null,
      "gate_type": null,
      "scope": null,
      "block_on": "Any check failure",
      "composed_of": [
        {
          "check": "typecheck",
          "command": "npm run type-check",
          "required": true,
          "parallel": true,
          "parallel_group": "static",
          "timeout_ms": 120000
        },
        {
          "check": "lint",
          "command": "npm run lint",
          "required": true,
          "parallel": true,
          "parallel_group": "static",
          "timeout_ms": 120000
        },
        {
          "check": "format",
          "command": "npm run format:check",
          "required": true,
          "parallel": true,
          "parallel_group": "static",
          "timeout_ms": 120000
        },
        {
          "check": "tests",
          "command": "npm test",
          "required": true,
          "depends_on": ["typecheck", "lint", "format"],
          "timeout_ms": 300000
        },
        {
          "check": "security",
          "agent": "security-audit",
          "required": true,
          "depends_on": ["tests"],
          "scope": "changed",
          "block_on": "Any P1 or P2 finding"
        },
        {
          "check": "code-review",
          "agent": "code-reviewer",
          "required": true,
          "depends_on": ["security"],
          "scope": "changed",
          "block_on": "Any Critical issue"
        }
      ],
      "completed_at": null,
      "evidence": null,
      "evidence_type": null,
      "reconciled": false,
      "reconciled_reason": null
    }
  ]
}
